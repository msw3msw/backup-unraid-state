<?xml version="1.0"?>
<Container version="2">
    <Name>BackupUnraidState</Name>
    <Repository>msw3msw/backup-unraid-state:latest</Repository>
    <Registry>https://hub.docker.com/r/msw3msw/backup-unraid-state</Registry>
    <Network>bridge</Network>
    <Privileged>true</Privileged>
    <Support>https://github.com/msw3msw/backup-unraid-state/issues</Support>
    <Project>https://github.com/msw3msw/backup-unraid-state</Project>
    <Overview>
Backup Unraid State v2.2 - A modern web interface for backing up your Unraid server.

BACKUP TYPES:
- VM backups (stop or live mode)
- Appdata backups (all or selective folders)  
- Plugin configuration backups
- Flash drive backup (disaster recovery)

NEW IN v2.2 - CONTAINER RESTORE:
- Saves container metadata during backup (image, ports, volumes)
- Restore appdata only, or pull image + restore
- One-click image pulling from Restore tab
- Saves Unraid templates for full container recreation

FEATURES:
- Real-time folder progress with elapsed time
- Progress bars on each backup card
- Card-scoped logs: Each backup has its own activity log
- Incremental appdata: rsync + hardlinks (storage efficient, easy restore)
- Scheduled automated backups (daily/weekly/monthly)
- Automatic rotation and cleanup
- Smart exclusions (cache, logs, temp files)
- Backup verification

Access the web UI at http://[IP]:[PORT:5050]/
    </Overview>
    <Category>Backup: Tools:</Category>
    <WebUI>http://[IP]:[PORT:5050]/</WebUI>
    <TemplateURL>https://raw.githubusercontent.com/msw3msw/backup-unraid-state/main/unraid-template.xml</TemplateURL>
    <Icon>https://raw.githubusercontent.com/msw3msw/backup-unraid-state/main/icon.png</Icon>
    <ExtraParams></ExtraParams>
    <PostArgs></PostArgs>
    <CPUset></CPUset>
    <DateInstalled></DateInstalled>
    <DonateText>Support Development</DonateText>
    <DonateLink></DonateLink>
    <Requires></Requires>
    <Description>Backup Unraid State v2.2 - Modern web interface for VM, appdata, plugin, and flash drive backups. NEW: Container restore with image pulling, metadata saving, and one-click recovery.</Description>
    
    <!-- Web UI Port -->
    <Config 
        Name="Web UI Port" 
        Target="5000" 
        Default="5050" 
        Mode="tcp" 
        Description="Port for the web interface. Access at http://[UNRAID_IP]:5050" 
        Type="Port" 
        Display="always" 
        Required="true" 
        Mask="false">5050</Config>
    
    <!-- Config Storage -->
    <Config 
        Name="Config Directory" 
        Target="/config" 
        Default="/mnt/user/appdata/backup-unraid-state" 
        Mode="rw" 
        Description="Where to store configuration files and logs" 
        Type="Path" 
        Display="always" 
        Required="true" 
        Mask="false">/mnt/user/appdata/backup-unraid-state</Config>
    
    <!-- IMPORTANT: Backup Destination -->
    <Config 
        Name="Backup Destination" 
        Target="/backup" 
        Default="" 
        Mode="rw" 
        Description="REQUIRED: Where to store backups. Use a remote/NAS share (e.g., /mnt/remotes/NAS/backups) or separate disk. Do NOT use the array you're backing up!" 
        Type="Path" 
        Display="always" 
        Required="true" 
        Mask="false"></Config>
    
    <!-- Source Paths -->
    <Config 
        Name="VM Storage Path" 
        Target="/domains" 
        Default="/mnt/user/domains" 
        Mode="ro" 
        Description="Where your VM disk images are stored" 
        Type="Path" 
        Display="always" 
        Required="true" 
        Mask="false">/mnt/user/domains</Config>
    
    <Config 
        Name="Appdata Path" 
        Target="/appdata" 
        Default="/mnt/user/appdata" 
        Mode="ro" 
        Description="Where your Docker container data is stored" 
        Type="Path" 
        Display="always" 
        Required="true" 
        Mask="false">/mnt/user/appdata</Config>
    
    <Config 
        Name="Plugin Configs Path" 
        Target="/plugins" 
        Default="/boot/config/plugins" 
        Mode="ro" 
        Description="Plugin configuration location" 
        Type="Path" 
        Display="always" 
        Required="false" 
        Mask="false">/boot/config/plugins</Config>
    
    <Config 
        Name="Flash Drive Path" 
        Target="/boot" 
        Default="/boot" 
        Mode="ro" 
        Description="USB flash drive path for disaster recovery backup" 
        Type="Path" 
        Display="always" 
        Required="true" 
        Mask="false">/boot</Config>
    
    <!-- Libvirt Socket -->
    <Config 
        Name="Libvirt Socket" 
        Target="/var/run/libvirt/libvirt-sock" 
        Default="/var/run/libvirt/libvirt-sock" 
        Mode="rw" 
        Description="Libvirt socket for VM control (stop/start VMs during backup)" 
        Type="Path" 
        Display="advanced" 
        Required="true" 
        Mask="false">/var/run/libvirt/libvirt-sock</Config>
    
    <!-- Docker Socket for container management -->
    <Config 
        Name="Docker Socket" 
        Target="/var/run/docker.sock" 
        Default="/var/run/docker.sock" 
        Mode="rw" 
        Description="Docker socket for container metadata and image pulling" 
        Type="Path" 
        Display="advanced" 
        Required="true" 
        Mask="false">/var/run/docker.sock</Config>
    
    <!-- Environment Variables -->
    <Config 
        Name="Max Backups to Keep" 
        Target="MAX_BACKUPS" 
        Default="2" 
        Mode="" 
        Description="Number of backup copies to keep per item (older ones auto-deleted)" 
        Type="Variable" 
        Display="always" 
        Required="false" 
        Mask="false">2</Config>
    
    <Config 
        Name="Timezone" 
        Target="TZ" 
        Default="America/New_York" 
        Mode="" 
        Description="Your timezone for scheduled backups (e.g., America/New_York, Europe/London, Australia/Sydney)" 
        Type="Variable" 
        Display="always" 
        Required="false" 
        Mask="false">America/New_York</Config>
</Container>
